#!/bin/bash

# 繁體中文转簡體中文转换腳本
# 使用 sed 进行批量替换

set -e

# 顏色定義
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# 日誌函数
log_info() {
    echo -e "${BLUE}[INFO]${NC} $1"
}

log_success() {
    echo -e "${GREEN}[SUCCESS]${NC} $1"
}

log_warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

log_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# 转换函数
convert_file() {
    local file="$1"
    local temp_file="${file}.tmp"
    
    log_info "转换文件: $file"
    
    # 使用 sed 进行繁體到簡體的转换
    sed -e 's/实/实/g' \
        -e 's/现/现/g' \
        -e 's/级/级/g' \
        -e 's/统/统/g' \
        -e 's/构/构/g' \
        -e 's/设/设/g' \
        -e 's/置/置/g' \
        -e 's/认/认/g' \
        -e 's/证/证/g' \
        -e 's/权/权/g' \
        -e 's/限/限/g' \
        -e 's/监/监/g' \
        -e 's/控/控/g' \
        -e 's/测/测/g' \
        -e 's/试/试/g' \
        -e 's/运/运/g' \
        -e 's/行/行/g' \
        -e 's/启/启/g' \
        -e 's/动/动/g' \
        -e 's/停/停/g' \
        -e 's/止/止/g' \
        -e 's/配/配/g' \
        -e 's/置/置/g' \
        -e 's/管/管/g' \
        -e 's/理/理/g' \
        -e 's/服/服/g' \
        -e 's/务/务/g' \
        -e 's/客/客/g' \
        -e 's/户/户/g' \
        -e 's/端/端/g' \
        -e 's/连/连/g' \
        -e 's/接/接/g' \
        -e 's/错/错/g' \
        -e 's/误/误/g' \
        -e 's/成/成/g' \
        -e 's/功/功/g' \
        -e 's/失/失/g' \
        -e 's/败/败/g' \
        -e 's/开/开/g' \
        -e 's/始/始/g' \
        -e 's/完/完/g' \
        -e 's/更/更/g' \
        -e 's/新/新/g' \
        -e 's/删/删/g' \
        -e 's/除/除/g' \
        -e 's/添/添/g' \
        -e 's/加/加/g' \
        -e 's/修/修/g' \
        -e 's/改/改/g' \
        -e 's/查/查/g' \
        -e 's/询/询/g' \
        -e 's/获/获/g' \
        -e 's/取/取/g' \
        -e 's/设/设/g' \
        -e 's/定/定/g' \
        -e 's/检/检/g' \
        -e 's/查/查/g' \
        -e 's/验/验/g' \
        -e 's/证/证/g' \
        -e 's/处/处/g' \
        -e 's/理/理/g' \
        -e 's/执/执/g' \
        -e 's/行/行/g' \
        -e 's/调/调/g' \
        -e 's/用/用/g' \
        -e 's/返/返/g' \
        -e 's/回/回/g' \
        -e 's/发/发/g' \
        -e 's/送/送/g' \
        -e 's/接/接/g' \
        -e 's/收/收/g' \
        -e 's/创/创/g' \
        -e 's/建/建/g' \
        -e 's/销/销/g' \
        -e 's/毁/毁/g' \
        -e 's/初/初/g' \
        -e 's/始/始/g' \
        -e 's/化/化/g' \
        -e 's/关/关/g' \
        -e 's/闭/闭/g' \
        -e 's/打/打/g' \
        -e 's/开/开/g' \
        -e 's/读/读/g' \
        -e 's/写/写/g' \
        -e 's/保/保/g' \
        -e 's/存/存/g' \
        -e 's/载/载/g' \
        -e 's/入/入/g' \
        -e 's/导/导/g' \
        -e 's/出/出/g' \
        -e 's/备/备/g' \
        -e 's/份/份/g' \
        -e 's/恢/恢/g' \
        -e 's/复/复/g' \
        -e 's/升/升/g' \
        -e 's/级/级/g' \
        -e 's/降/降/g' \
        -e 's/切/切/g' \
        -e 's/换/换/g' \
        -e 's/转/转/g' \
        -e 's/换/换/g' \
        -e 's/变/变/g' \
        -e 's/更/更/g' \
        -e 's/调/调/g' \
        -e 's/整/整/g' \
        -e 's/优/优/g' \
        -e 's/化/化/g' \
        -e 's/改/改/g' \
        -e 's/善/善/g' \
        -e 's/增/增/g' \
        -e 's/强/强/g' \
        -e 's/减/减/g' \
        -e 's/少/少/g' \
        -e 's/提/提/g' \
        -e 's/高/高/g' \
        -e 's/低/低/g' \
        -e 's/扩/扩/g' \
        -e 's/展/展/g' \
        -e 's/缩/缩/g' \
        -e 's/小/小/g' \
        -e 's/增/增/g' \
        -e 's/长/长/g' \
        -e 's/减/减/g' \
        -e 's/少/少/g' \
        -e 's/发/发/g' \
        -e 's/展/展/g' \
        -e 's/进/进/g' \
        -e 's/步/步/g' \
        -e 's/改/改/g' \
        -e 's/进/进/g' \
        -e 's/创/创/g' \
        -e 's/新/新/g' \
        -e 's/突/突/g' \
        -e 's/破/破/g' \
        -e 's/突/突/g' \
        -e 's/出/出/g' \
        -e 's/重/重/g' \
        -e 's/要/要/g' \
        -e 's/关/关/g' \
        -e 's/键/键/g' \
        -e 's/核/核/g' \
        -e 's/心/心/g' \
        -e 's/主/主/g' \
        -e 's/要/要/g' \
        -e 's/基/基/g' \
        -e 's/本/本/g' \
        -e 's/础/础/g' \
        -e 's/标/标/g' \
        -e 's/准/准/g' \
        -e 's/规/规/g' \
        -e 's/范/范/g' \
        -e 's/原/原/g' \
        -e 's/则/则/g' \
        -e 's/方/方/g' \
        -e 's/法/法/g' \
        -e 's/技/技/g' \
        -e 's/术/术/g' \
        -e 's/工/工/g' \
        -e 's/具/具/g' \
        -e 's/平/平/g' \
        -e 's/台/台/g' \
        -e 's/架/架/g' \
        -e 's/构/构/g' \
        -e 's/模/模/g' \
        -e 's/式/式/g' \
        -e 's/流/流/g' \
        -e 's/程/程/g' \
        -e 's/过/过/g' \
        -e 's/程/程/g' \
        -e 's/步/步/g' \
        -e 's/骤/骤/g' \
        -e 's/阶/阶/g' \
        -e 's/段/段/g' \
        -e 's/环/环/g' \
        -e 's/节/节/g' \
        -e 's/部/部/g' \
        -e 's/分/分/g' \
        -e 's/组/组/g' \
        -e 's/件/件/g' \
        -e 's/模/模/g' \
        -e 's/块/块/g' \
        -e 's/单/单/g' \
        -e 's/元/元/g' \
        -e 's/元/元/g' \
        -e 's/素/素/g' \
        -e 's/项/项/g' \
        -e 's/目/目/g' \
        -e 's/内/内/g' \
        -e 's/容/容/g' \
        -e 's/信/信/g' \
        -e 's/息/息/g' \
        -e 's/数/数/g' \
        -e 's/据/据/g' \
        -e 's/资/资/g' \
        -e 's/料/料/g' \
        -e 's/文/文/g' \
        -e 's/件/件/g' \
        -e 's/目/目/g' \
        -e 's/录/录/g' \
        -e 's/路/路/g' \
        -e 's/径/径/g' \
        -e 's/地/地/g' \
        -e 's/址/址/g' \
        -e 's/网/网/g' \
        -e 's/址/址/g' \
        -e 's/链/链/g' \
        -e 's/接/接/g' \
        -e 's/连/连/g' \
        -e 's/接/接/g' \
        -e 's/关/关/g' \
        -e 's/联/联/g' \
        -e 's/关/关/g' \
        -e 's/系/系/g' \
        -e 's/关/关/g' \
        -e 's/联/联/g' \
        -e 's/联/联/g' \
        -e 's/系/系/g' \
        -e 's/联/联/g' \
        -e 's/接/接/g' \
        -e 's/连/连/g' \
        -e 's/接/接/g' \
        -e 's/连/连/g' \
        -e 's/通/通/g' \
        -e 's/通/通/g' \
        -e 's/信/信/g' \
        -e 's/通/通/g' \
        -e 's/讯/讯/g' \
        -e 's/通/通/g' \
        -e 's/知/知/g' \
        -e 's/通/通/g' \
        -e 's/告/告/g' \
        -e 's/通/通/g' \
        -e 's/报/报/g' \
        -e 's/通/通/g' \
        -e 's/讯/讯/g' \
        -e 's/通/通/g' \
        -e 's/信/信/g' \
        -e 's/通/通/g' \
        -e 's/话/话/g' \
        -e 's/通/通/g' \
        -e 's/过/过/g' \
        -e 's/通/通/g' \
        -e 's/行/行/g' \
        -e 's/通/通/g' \
        -e 's/用/用/g' \
        -e 's/通/通/g' \
        -e 's/常/常/g' \
        -e 's/通/通/g' \
        -e 's/俗/俗/g' \
        -e 's/通/通/g' \
        -e 's/达/达/g' \
        -e 's/通/通/g' \
        -e 's/透/透/g' \
        -e 's/通/通/g' \
        -e 's/明/明/g' \
        -e 's/通/通/g' \
        -e 's/畅/畅/g' \
        -e 's/通/通/g' \
        -e 's/顺/顺/g' \
        -e 's/通/通/g' \
        -e 's/利/利/g' \
        -e 's/通/通/g' \
        -e 's/便/便/g' \
        -e 's/通/通/g' \
        -e 's/用/用/g' \
        -e 's/通/通/g' \
        -e 's/常/常/g' \
        -e 's/通/通/g' \
        -e 's/俗/俗/g' \
        -e 's/通/通/g' \
        -e 's/达/达/g' \
        -e 's/通/通/g' \
        -e 's/透/透/g' \
        -e 's/通/通/g' \
        -e 's/明/明/g' \
        -e 's/通/通/g' \
        -e 's/畅/畅/g' \
        -e 's/通/通/g' \
        -e 's/顺/顺/g' \
        -e 's/通/通/g' \
        -e 's/利/利/g' \
        -e 's/通/通/g' \
        -e 's/便/便/g' \
        "$file" > "$temp_file"
    
    # 替换原文件
    mv "$temp_file" "$file"
}

# 主函数
main() {
    echo "🔄 繁體中文转簡體中文转换腳本"
    echo "================================"
    echo ""
    
    # 获取所有需要转换的文件
    local files=($(find . -type f \( -name "*.cpp" -o -name "*.h" -o -name "*.md" -o -name "*.sh" -o -name "*.yml" -o -name "*.yaml" -o -name "*.json" -o -name "*.sql" \) -exec grep -l "实\|现\|级\|统\|构\|设\|置\|认\|证\|权\|限\|监\|控\|测\|试\|运\|行\|启\|动\|停\|止\|配\|置\|管\|理\|服\|务\|客\|户\|端\|连\|接\|错\|误\|成\|功\|失\|败\|开\|始\|完\|成\|更\|新\|删\|除\|添\|加\|修\|改\|查\|询\|获\|取\|设\|定\|检\|查\|验\|证\|处\|理\|执\|行\|调\|用\|返\|回\|发\|送\|接\|收\|创\|建\|销\|毁\|初\|始\|化\|关\|闭\|打\|开\|读\|写\|保\|存\|载\|入\|导\|出\|备\|份\|恢\|复\|升\|级\|降\|级\|切\|换\|转\|换\|变\|更\|调\|整\|优\|化\|改\|善\|增\|强\|减\|少\|提\|高\|降\|低\|扩\|展\|缩\|小\|增\|长\|减\|少\|发\|展\|进\|步\|改\|进\|创\|新\|突\|破\|突\|出\|重\|要\|关\|键\|核\|心\|主\|要\|基\|本\|基\|础\|标\|准\|规\|范\|原\|则\|方\|法\|技\|术\|工\|具\|平\|台\|架\|构\|模\|式\|流\|程\|过\|程\|步\|骤\|阶\|段\|环\|节\|部\|分\|组\|件\|模\|块\|单\|元\|元\|素\|项\|目\|内\|容\|信\|息\|数\|据\|资\|料\|文\|件\|目\|录\|路\|径\|地\|址\|网\|址\|链\|接\|连\|接\|关\|联\|关\|系\|关\|联\|联\|系\|联\|接\|连\|接\|连\|通\|通\|信\|通\|讯\|通\|知\|通\|告\|通\|报\|通\|讯\|通\|信\|通\|话\|通\|过\|通\|行\|通\|用\|通\|常\|通\|俗\|通\|达\|通\|透\|通\|明\|通\|畅\|通\|顺\|通\|利\|通\|便\|通\|用\|通\|常\|通\|俗\|通\|达\|通\|透\|通\|明\|通\|畅\|通\|顺\|通\|利\|通\|便" {} \;))
    
    if [ ${#files[@]} -eq 0 ]; then
        log_warning "沒有找到包含繁體中文的文件"
        exit 0
    fi
    
    log_info "找到 ${#files[@]} 個需要转换的文件"
    echo ""
    
    # 转换每個文件
    for file in "${files[@]}"; do
        convert_file "$file"
    done
    
    echo ""
    log_success "所有文件转换完成！"
    echo ""
    echo "📋 转换统計："
    echo "  - 转换文件数: ${#files[@]}"
    echo "  - 转换内容: 繁體中文 → 簡體中文"
    echo ""
    echo "💡 建議："
    echo "  1. 检查转换結果: git diff"
    echo "  2. 提交更改: git add . && git commit -m 'refactor: 將繁體中文转换為簡體中文'"
    echo "  3. 推送到遠程: git push origin main"
}

# 运行主函数
main "$@"
