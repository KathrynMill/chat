#!/bin/bash

# 修復剩餘的繁體中文轉簡體中文腳本

set -e

# 顏色定義
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# 日誌函數
log_info() {
    echo -e "${BLUE}[INFO]${NC} $1"
}

log_success() {
    echo -e "${GREEN}[SUCCESS]${NC} $1"
}

# 修復函數
fix_file() {
    local file="$1"
    local temp_file="${file}.tmp"
    
    log_info "修復文件: $file"
    
    # 使用 sed 進行更完整的繁體到簡體轉換
    sed -e 's/企業级/企业级/g' \
        -e 's/微服务/微服务/g' \
        -e 's/聊天系统/聊天系统/g' \
        -e 's/功能清单/功能清单/g' \
        -e 's/项目概述/项目概述/g' \
        -e 's/系统架构/系统架构/g' \
        -e 's/技术棧/技术栈/g' \
        -e 's/资料庫/数据库/g' \
        -e 's/讯息隊列/消息队列/g' \
        -e 's/服务发现/服务发现/g' \
        -e 's/容器化/容器化/g' \
        -e 's/监控/监控/g' \
        -e 's/追蹤/追踪/g' \
        -e 's/认证/认证/g' \
        -e 's/核心功能/核心功能/g' \
        -e 's/用户管理/用户管理/g' \
        -e 's/用户註冊/用户注册/g' \
        -e 's/登入/登录/g' \
        -e 's/密碼/密码/g' \
        -e 's/存儲/存储/g' \
        -e 's/身份验证/身份验证/g' \
        -e 's/用户资料/用户资料/g' \
        -e 's/社交功能/社交功能/g' \
        -e 's/好友添加/好友添加/g' \
        -e 's/删除/删除/g' \
        -e 's/好友列表/好友列表/g' \
        -e 's/查询/查询/g' \
        -e 's/群组创建/群组创建/g' \
        -e 's/管理/管理/g' \
        -e 's/群组成員/群组成员/g' \
        -e 's/群组列表/群组列表/g' \
        -e 's/讯息系统/消息系统/g' \
        -e 's/一對一/一对一/g' \
        -e 's/私聊/私聊/g' \
        -e 's/群组聊天/群组聊天/g' \
        -e 's/讯息持久化/消息持久化/g' \
        -e 's/離線/离线/g' \
        -e 's/讯息歷史/消息历史/g' \
        -e 's/实時/实时/g' \
        -e 's/推送/推送/g' \
        -e 's/实時通信/实时通信/g' \
        -e 's/连接/连接/g' \
        -e 's/在線/在线/g' \
        -e 's/狀態/状态/g' \
        -e 's/讯息即時/消息即时/g' \
        -e 's/连接狀態/连接状态/g' \
        -e 's/企業级特性/企业级特性/g' \
        -e 's/負载均衡/负载均衡/g' \
        -e 's/整合/整合/g' \
        -e 's/自动/自动/g' \
        -e 's/註冊/注册/g' \
        -e 's/发现/发现/g' \
        -e 's/健康检查/健康检查/g' \
        -e 's/故障转移/故障转移/g' \
        -e 's/輪询/轮询/g' \
        -e 's/动態/动态/g' \
        -e 's/实例/实例/g' \
        -e 's/服务网格/服务网格/g' \
        -e 's/通信/通信/g' \
        -e 's/故障容错/故障容错/g' \
        -e 's/熔斷器/熔断器/g' \
        -e 's/防止/防止/g' \
        -e 's/级联/级联/g' \
        -e 's/故障/故障/g' \
        -e 's/重试機制/重试机制/g' \
        -e 's/失败/失败/g' \
        -e 's/請求/请求/g' \
        -e 's/超時/超时/g' \
        -e 's/控制/控制/g' \
        -e 's/保護/保护/g' \
        -e 's/降级策略/降级策略/g' \
        -e 's/降级/降级/g' \
        -e 's/容错/容错/g' \
        -e 's/安全认证/安全认证/g' \
        -e 's/無狀態/无状态/g' \
        -e 's/验证/验证/g' \
        -e 's/簽名/签名/g' \
        -e 's/算法/算法/g' \
        -e 's/Token/Token/g' \
        -e 's/验证/验证/g' \
        -e 's/权限控制/权限控制/g' \
        -e 's/基於/基于/g' \
        -e 's/角色/角色/g' \
        -e 's/訪問/访问/g' \
        -e 's/分散式追蹤/分布式追踪/g' \
        -e 's/跨服务/跨服务/g' \
        -e 's/注入/注入/g' \
        -e 's/HTTP/HTTP/g' \
        -e 's/追蹤/追踪/g' \
        -e 's/視覺化/可视化/g' \
        -e 's/性能分析/性能分析/g' \
        -e 's/链路/链路/g' \
        -e 's/指标监控/指标监控/g' \
        -e 's/收集/收集/g' \
        -e 's/存儲/存储/g' \
        -e 's/業务/业务/g' \
        -e 's/用户/用户/g' \
        -e 's/连接数/连接数/g' \
        -e 's/讯息量/消息量/g' \
        -e 's/技术指标/技术指标/g' \
        -e 's/QPS/QPS/g' \
        -e 's/延遲/延迟/g' \
        -e 's/错误率/错误率/g' \
        -e 's/面板/面板/g' \
        -e 's/告警/告警/g' \
        -e 's/容器化部署/容器化部署/g' \
        -e 's/多阶段/多阶段/g' \
        -e 's/建置/构建/g' \
        -e 's/优化/优化/g' \
        -e 's/一键/一键/g' \
        -e 's/部署/部署/g' \
        -e 's/生產级/生产级/g' \
        -e 's/配置/配置/g' \
        -e 's/重启/重启/g' \
        -e 's/监控與运維/监控与运维/g' \
        -e 's/监控指标/监控指标/g' \
        -e 's/系统指标/系统指标/g' \
        -e 's/記憶體/内存/g' \
        -e 's/网路/网络/g' \
        -e 's/磁碟/磁盘/g' \
        -e 's/應用/应用/g' \
        -e 's/调用率/调用率/g' \
        -e 's/活躍/活跃/g' \
        -e 's/吞吐量/吞吐量/g' \
        -e 's/基础设施/基础设施/g' \
        -e 's/资料庫/数据库/g' \
        -e 's/查询率/查询率/g' \
        -e 's/讯息率/消息率/g' \
        -e 's/告警规则/告警规则/g' \
        -e 's/不可用/不可用/g' \
        -e 's/健康检查/健康检查/g' \
        -e 's/失败/失败/g' \
        -e 's/高错误率/高错误率/g' \
        -e 's/超过/超过/g' \
        -e 's/閾值/阈值/g' \
        -e 's/高延遲/高延迟/g' \
        -e 's/響應/响应/g' \
        -e 's/资源不足/资源不足/g' \
        -e 's/使用率/使用率/g' \
        -e 's/过高/过高/g' \
        -e 's/运維工具/运维工具/g' \
        -e 's/腳本/脚本/g' \
        -e 's/系统监控/系统监控/g' \
        -e 's/测试/测试/g' \
        -e 's/端到端/端到端/g' \
        -e 's/运維文檔/运维文档/g' \
        -e 's/运維指南/运维指南/g' \
        -e 's/开发與部署/开发与部署/g' \
        -e 's/开发环境/开发环境/g' \
        -e 's/編譯/编译/g' \
        -e 's/项目/项目/g' \
        -e 's/启动/启动/g' \
        -e 's/服务/服务/g' \
        -e 's/生產部署/生产部署/g' \
        -e 's/Compose/Compose/g' \
        -e 's/Kubernetes/Kubernetes/g' \
        -e 's/监控系统/监控系统/g' \
        -e 's/测试验证/测试验证/g' \
        -e 's/完整/完整/g' \
        -e 's/性能/性能/g' \
        -e 's/健康检查/健康检查/g' \
        -e 's/性能特性/性能特性/g' \
        -e 's/高併发/高并发/g' \
        -e 's/支持/支持/g' \
        -e 's/连接池/连接池/g' \
        -e 's/管理/管理/g' \
        -e 's/異步/异步/g' \
        -e 's/处理/处理/g' \
        -e 's/阻塞/阻塞/g' \
        -e 's/操作/操作/g' \
        -e 's/負载/负载/g' \
        -e 's/分散/分散/g' \
        -e 's/快取/缓存/g' \
        -e 's/機制/机制/g' \
        -e 's/优化/优化/g' \
        -e 's/可扩展性/可扩展性/g' \
        -e 's/水平扩展/水平扩展/g' \
        -e 's/实例/实例/g' \
        -e 's/扩展/扩展/g' \
        -e 's/垂直扩展/垂直扩展/g' \
        -e 's/资源/资源/g' \
        -e 's/调整/调整/g' \
        -e 's/分片/分片/g' \
        -e 's/大数据量/大数据量/g' \
        -e 's/讯息分區/消息分区/g' \
        -e 's/分區/分区/g' \
        -e 's/負载/负载/g' \
        -e 's/高可用性/高可用性/g' \
        -e 's/转移/转移/g' \
        -e 's/检测/检测/g' \
        -e 's/数据备份/数据备份/g' \
        -e 's/定期/定期/g' \
        -e 's/災難/灾难/g' \
        -e 's/恢复/恢复/g' \
        -e 's/快速/快速/g' \
        -e 's/零停機/零停机/g' \
        -e 's/滾动/滚动/g' \
        -e 's/更新/更新/g' \
        -e 's/安全特性/安全特性/g' \
        -e 's/数据安全/数据安全/g' \
        -e 's/加密/加密/g' \
        -e 's/敏感/敏感/g' \
        -e 's/傳輸/传输/g' \
        -e 's/安全/安全/g' \
        -e 's/TLS/SSL/TLS/SSL/g' \
        -e 's/訪問/访问/g' \
        -e 's/審計/审计/g' \
        -e 's/日誌/日志/g' \
        -e 's/操作/操作/g' \
        -e 's/追蹤/追踪/g' \
        -e 's/网路安全/网络安全/g' \
        -e 's/防火牆/防火墙/g' \
        -e 's/网路/网络/g' \
        -e 's/遠程/远程/g' \
        -e 's/DDoS/DDoS/g' \
        -e 's/防護/防护/g' \
        -e 's/分散式/分布式/g' \
        -e 's/拒絕/拒绝/g' \
        -e 's/入侵检测/入侵检测/g' \
        -e 's/異常/异常/g' \
        -e 's/行為/行为/g' \
        -e 's/检测/检测/g' \
        -e 's/文檔與支持/文档与支持/g' \
        -e 's/技术文檔/技术文档/g' \
        -e 's/接口/接口/g' \
        -e 's/文檔/文档/g' \
        -e 's/部署指南/部署指南/g' \
        -e 's/詳細/详细/g' \
        -e 's/说明/说明/g' \
        -e 's/运維手冊/运维手册/g' \
        -e 's/运維/运维/g' \
        -e 's/操作/操作/g' \
        -e 's/指南/指南/g' \
        -e 's/故障排查/故障排查/g' \
        -e 's/常見/常见/g' \
        -e 's/問題/问题/g' \
        -e 's/解決/解决/g' \
        -e 's/方案/方案/g' \
        -e 's/开发支持/开发支持/g' \
        -e 's/代碼/代码/g' \
        -e 's/註釋/注释/g' \
        -e 's/单元/单元/g' \
        -e 's/覆蓋/覆盖/g' \
        -e 's/集成/集成/g' \
        -e 's/負载/负载/g' \
        -e 's/工具/工具/g' \
        -e 's/未來规劃/未来规划/g' \
        -e 's/短期目标/短期目标/g' \
        -e 's/日誌/日志/g' \
        -e 's/聚合/聚合/g' \
        -e 's/Stack/Stack/g' \
        -e 's/网格/网格/g' \
        -e 's/Istio/Istio/g' \
        -e 's/自动扩缩容/自动扩缩容/g' \
        -e 's/HPA/HPA/g' \
        -e 's/金絲雀/金丝雀/g' \
        -e 's/长期目标/长期目标/g' \
        -e 's/混沌/混沌/g' \
        -e 's/工程/工程/g' \
        -e 's/Chaos/Chaos/g' \
        -e 's/Monkey/Monkey/g' \
        -e 's/機器/机器/g' \
        -e 's/學習/学习/g' \
        -e 's/推薦/推荐/g' \
        -e 's/多語言/多语言/g' \
        -e 's/移动端/移动端/g' \
        -e 's/SDK/SDK/g' \
        -e 's/项目亮點/项目亮点/g' \
        -e 's/完整/完整/g' \
        -e 's/企業级/企业级/g' \
        -e 's/架构/架构/g' \
        -e 's/從/从/g' \
        -e 's/开发/开发/g' \
        -e 's/部署/部署/g' \
        -e 's/完整/完整/g' \
        -e 's/解決/解决/g' \
        -e 's/生產级/生产级/g' \
        -e 's/具备/具备/g' \
        -e 's/生产/生产/g' \
        -e 's/环境/环境/g' \
        -e 's/所需/所需/g' \
        -e 's/所有/所有/g' \
        -e 's/核心/核心/g' \
        -e 's/特性/特性/g' \
        -e 's/高度/高度/g' \
        -e 's/可扩展/可扩展/g' \
        -e 's/水平/水平/g' \
        -e 's/垂直/垂直/g' \
        -e 's/完善/完善/g' \
        -e 's/全方位/全方位/g' \
        -e 's/告警/告警/g' \
        -e 's/系统/系统/g' \
        -e 's/易於/易于/g' \
        -e 's/运維/运维/g' \
        -e 's/豐富/丰富/g' \
        -e 's/工具/工具/g' \
        -e 's/文檔/文档/g' \
        -e 's/安全可靠/安全可靠/g' \
        -e 's/多層次/多层次/g' \
        -e 's/保護/保护/g' \
        -e 's/總結/总结/g' \
        -e 's/這/这/g' \
        -e 's/個/个/g' \
        -e 's/功能/功能/g' \
        -e 's/完整/完整/g' \
        -e 's/架构/架构/g' \
        -e 's/先进/先进/g' \
        -e 's/运維/运维/g' \
        -e 's/友好/友好/g' \
        -e 's/企业级/企业级/g' \
        -e 's/聊天/聊天/g' \
        -e 's/系统/系统/g' \
        -e 's/適合/适合/g' \
        -e 's/用於/用于/g' \
        -e 's/生产/生产/g' \
        -e 's/环境/环境/g' \
        -e 's/部署/部署/g' \
        -e 's/學習/学习/g' \
        -e 's/微服务/微服务/g' \
        -e 's/架构/架构/g' \
        -e 's/设計/设计/g' \
        "$file" > "$temp_file"
    
    # 替換原文件
    mv "$temp_file" "$file"
}

# 主函數
main() {
    echo "🔧 修復剩餘繁體中文轉簡體中文"
    echo "================================"
    echo ""
    
    # 獲取所有需要修復的文件
    local files=($(find . -type f \( -name "*.cpp" -o -name "*.h" -o -name "*.md" -o -name "*.sh" -o -name "*.yml" -o -name "*.yaml" -o -name "*.json" -o -name "*.sql" \) -exec grep -l "企業级\|微服务\|聊天系统\|功能清单\|项目概述\|系统架构\|技术棧\|资料庫\|讯息隊列\|服务发现\|容器化\|监控\|追蹤\|认证\|核心功能\|用户管理\|用户註冊\|登入\|密碼\|存儲\|身份验证\|用户资料\|社交功能\|好友添加\|删除\|好友列表\|查询\|群组创建\|管理\|群组成員\|群组列表\|讯息系统\|一對一\|私聊\|群组聊天\|讯息持久化\|離線\|讯息歷史\|实時\|推送\|实時通信\|连接\|在線\|狀態\|讯息即時\|连接狀態\|企業级特性\|負载均衡\|整合\|自动\|註冊\|发现\|健康检查\|故障转移\|輪询\|动態\|实例\|服务网格\|通信\|故障容错\|熔斷器\|防止\|级联\|故障\|重试機制\|失败\|請求\|超時\|控制\|保護\|降级策略\|降级\|容错\|安全认证\|無狀態\|验证\|簽名\|算法\|Token\|验证\|权限控制\|基於\|角色\|訪問\|分散式追蹤\|跨服务\|注入\|HTTP\|追蹤\|視覺化\|性能分析\|链路\|指标监控\|收集\|存儲\|業务\|用户\|连接数\|讯息量\|技术指标\|QPS\|延遲\|错误率\|面板\|告警\|容器化部署\|多阶段\|建置\|优化\|一键\|部署\|生產级\|配置\|重启\|监控與运維\|监控指标\|系统指标\|記憶體\|网路\|磁碟\|應用\|调用率\|活躍\|吞吐量\|基础设施\|资料庫\|查询率\|讯息率\|告警规则\|不可用\|健康检查\|失败\|高错误率\|超过\|閾值\|高延遲\|響應\|资源不足\|使用率\|过高\|运維工具\|腳本\|系统监控\|测试\|端到端\|运維文檔\|运維指南\|开发與部署\|开发环境\|編譯\|项目\|启动\|服务\|生產部署\|Compose\|Kubernetes\|监控系统\|测试验证\|完整\|性能\|健康检查\|性能特性\|高併发\|支持\|连接池\|管理\|異步\|处理\|阻塞\|操作\|負载\|分散\|快取\|機制\|优化\|可扩展性\|水平扩展\|实例\|扩展\|垂直扩展\|资源\|调整\|分片\|大数据量\|讯息分區\|分區\|負载\|高可用性\|转移\|检测\|数据备份\|定期\|災難\|恢复\|快速\|零停機\|滾动\|更新\|安全特性\|数据安全\|加密\|敏感\|傳輸\|安全\|TLS/SSL\|訪問\|審計\|日誌\|操作\|追蹤\|网路安全\|防火牆\|网路\|遠程\|DDoS\|防護\|分散式\|拒絕\|入侵检测\|異常\|行為\|检测\|文檔與支持\|技术文檔\|接口\|文檔\|部署指南\|詳細\|说明\|运維手冊\|运維\|操作\|指南\|故障排查\|常見\|問題\|解決\|方案\|开发支持\|代碼\|註釋\|单元\|覆蓋\|集成\|負载\|工具\|未來规劃\|短期目标\|日誌\|聚合\|Stack\|网格\|Istio\|自动扩缩容\|HPA\|金絲雀\|长期目标\|混沌\|工程\|Chaos\|Monkey\|機器\|學習\|推薦\|多語言\|移动端\|SDK\|项目亮點\|完整\|企業级\|架构\|從\|开发\|部署\|完整\|解決\|生產级\|具备\|生产\|环境\|所需\|所有\|核心\|特性\|高度\|可扩展\|水平\|垂直\|完善\|全方位\|告警\|系统\|易於\|运維\|豐富\|工具\|文檔\|安全可靠\|多層次\|保護\|總結\|這\|個\|功能\|完整\|架构\|先进\|运維\|友好\|企业级\|聊天\|系统\|適合\|用於\|生产\|环境\|部署\|學習\|微服务\|架构\|设計" {} \;))
    
    if [ ${#files[@]} -eq 0 ]; then
        log_info "沒有找到需要修復的文件"
        exit 0
    fi
    
    log_info "找到 ${#files[@]} 個需要修復的文件"
    echo ""
    
    # 修復每個文件
    for file in "${files[@]}"; do
        fix_file "$file"
    done
    
    echo ""
    log_success "所有文件修復完成！"
    echo ""
    echo "📋 修復統計："
    echo "  - 修復文件數: ${#files[@]}"
    echo "  - 修復內容: 剩餘繁體中文 → 簡體中文"
    echo ""
    echo "💡 建議："
    echo "  1. 檢查修復結果: git diff"
    echo "  2. 提交更改: git add . && git commit -m 'fix: 修復剩餘繁體中文轉簡體中文'"
    echo "  3. 推送到遠程: git push origin main"
}

# 運行主函數
main "$@"
